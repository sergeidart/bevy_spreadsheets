// src/ui/elements/editor/state/default.rs
// Default implementation for EditorWindowState

use super::state_definitions::*;
use crate::sheets::definitions::ColumnDataType;
use std::collections::{HashMap, HashSet, VecDeque};

impl Default for EditorWindowState {
    fn default() -> Self {
        Self {
            selected_category: None,
            selected_sheet_name: None,
            virtual_structure_stack: Vec::new(),
            structure_navigation_stack: Vec::new(),
            show_rename_popup: false,
            rename_target_category: None,
            rename_target_sheet: String::new(),
            new_name_input: String::new(),
            show_delete_confirm_popup: false,
            delete_target_category: None,
            delete_target_sheet: String::new(),
            show_column_options_popup: false,
            options_column_target_category: None,
            options_column_target_sheet: String::new(),
            options_column_target_index: 0,
            column_options_popup_needs_init: false,
            options_column_rename_input: String::new(),
            options_column_filter_input: String::new(),
            options_column_filter_terms: vec![String::new()],
            options_column_ai_context_input: String::new(),
            options_validator_type: None,
            options_basic_type_select: ColumnDataType::String,
            options_link_target_sheet: None,
            options_link_target_column_index: None,
            options_structure_source_columns: vec![None],
            linked_column_cache: HashMap::new(),
            linked_column_cache_normalized: HashMap::new(),
            show_new_sheet_popup: false,
            new_sheet_name_input: String::new(),
            new_sheet_target_category: None,
            new_sheet_show_validation_hint: false,
            show_add_table_popup: false,
            show_new_category_popup: false,
            new_category_name_input: String::new(),
            show_delete_category_confirm_popup: false,
            delete_category_name: None,
            show_delete_category_double_confirm_popup: false,
            ai_mode: AiModeState::Idle,
            ai_selected_rows: HashSet::new(),
            ai_batch_review_active: false,
            ai_row_reviews: Vec::new(),
            ai_new_row_reviews: Vec::new(),
            ai_structure_reviews: Vec::new(),
            ai_structure_new_row_contexts: HashMap::new(),
            ai_structure_new_row_token_counter: 0,
            ai_original_row_snapshot_cache: HashMap::new(),
            ai_model_id_input: String::new(),
            ai_general_rule_input: String::new(),
            ai_structure_detail_context: None,

            ai_call_log: Vec::new(),
            ai_raw_output_display: String::new(),
            ai_output_panel_visible: false,
            ai_group_add_popup_open: false,
            ai_group_add_name_input: String::new(),
            ai_group_rename_popup_open: false,
            ai_group_rename_target: None,
            ai_group_rename_input: String::new(),
            ai_group_delete_popup_open: false,
            ai_group_delete_target: None,
            ai_group_delete_target_category: None,
            ai_group_delete_target_sheet: None,
            ai_pending_structure_jobs: VecDeque::new(),
            ai_active_structure_job: None,
            ai_last_send_root_rows: Vec::new(),
            ai_last_send_root_category: None,
            ai_last_send_root_sheet: None,
            ai_planned_structure_paths: Vec::new(),
            ai_phase1_intermediate: None,
            ai_expecting_phase2_result: false,
            ai_structure_results_expected: 0,
            ai_structure_results_received: 0,
            ai_waiting_for_structure_results: false,
            ai_structure_generation_counter: 0,
            ai_structure_active_generation: 0,
            ai_total_tasks: 0,
            ai_completed_tasks: 0,
            show_settings_popup: false,
            settings_new_api_key_input: String::new(),
            was_settings_popup_open: false,
            show_ai_rule_popup: false,
            ai_rule_popup_needs_init: false,
            ai_rule_popup_last_category: None,
            ai_rule_popup_last_sheet: None,
            ai_rule_popup_grounding: None,
            filtered_row_indices_cache: HashMap::new(),
            force_filter_recalculation: false,
            request_scroll_to_new_row: false,
            scroll_to_row_index: None,
            current_interaction_mode: SheetInteractionState::Idle,
            selected_columns_for_deletion: HashSet::new(),
            column_drag_state: ColumnDragState::default(),
            dragged_sheet: None,

            show_random_picker_panel: false,
            random_picker_mode_is_complex: false,
            random_simple_result_col: 0,
            random_complex_result_col: 0,
            random_complex_weight_col: None,
            random_complex_second_weight_col: None,
            random_picker_weight_columns: vec![None],
            random_picker_weight_exponents: vec![1.0],
            random_picker_weight_multipliers: vec![1.0],
            random_picker_last_value: String::new(),
            random_picker_copy_status: String::new(),
            random_picker_needs_init: true,
            summarizer_selected_col: 0,
            summarizer_last_result: String::new(),
            summarizer_copy_status: String::new(),
            summarizer_selected_columns: vec![None],
            pending_validator_change_requires_confirmation: false,
            pending_validator_new_validator_summary: None,
            pending_validator_target_is_structure: false,
            options_structure_key_parent_column_temp: None,
            options_existing_structure_key_parent_column: None,
            ai_context_only_prefix_count: 0,
            pending_structure_key_apply: None,
            ai_context_prefix_by_row: HashMap::new(),
            category_picker_expanded: true,
            sheet_picker_expanded: true,
            ai_groups_expanded: true,
            show_edit_mode_panel: false,
            last_ai_button_min_x: 0.0,
            last_edit_mode_button_min_x: 0.0,
            last_toybox_button_min_x: 0.0,
            show_toybox_menu: false,
            toybox_mode: ToyboxMode::Randomizer,
            fps_setting: FpsSetting::default(),
            show_hidden_sheets: false,
            ai_throttled_apply_queue: VecDeque::new(),
            ai_throttled_batch_add_queue: VecDeque::new(),
            ai_batch_has_undecided_merge: false,
            show_ai_prompt_popup: false,
            ai_prompt_input: String::new(),
            last_ai_prompt_only: false,
            ai_cached_included_columns: Vec::new(),
            ai_cached_included_structure_columns: Vec::new(),
            ai_cached_included_columns_category: None,
            ai_cached_included_columns_sheet: None,
            ai_cached_included_columns_path: Vec::new(),
            ai_cached_included_columns_dirty: true,
            ai_cached_included_columns_valid: false,
            ui_structure_row_count_cache: std::collections::HashMap::new(),
            last_header_right_edge_x: 0.0,
        }
    }
}
